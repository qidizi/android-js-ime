<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        // 直接在这里追加自定义模块即可
        let vue_components = [
            'kbd-wu-bi',
            'kbd-en',
            'kbd-quick',
            "speech"
        ];
        ///////////////////////

        // 独立出来，防止其它js出错
        function debug() {
            //console.log.apply(console, arguments);
            let dom = document.getElementById('debug_box');
            dom.style.display = 'block';
            let str = [];

            for (let i = 0; i < arguments.length; i++) {
                let type = Object.prototype.toString.call(arguments[i]).toLowerCase().substr(8).replace(']', '');
                str.push('[' + type + ']' + JSON.stringify(arguments[i]));
            }

            dom.prepend(str.join('\t'), document.createElement('br'));
        }

        window.addEventListener('error', function (ev) {
            debug.call(window, 'js异常：' + ev.message + ' @ ' + ev.filename + ' ' + ev.lineno + ':' + ev.colno);
        });
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>js键盘</title>
    <link rel="icon" href="data:image/ico;base64,aWNv">
</head>
<body>
<p id="init"><!--方便检查是否加载html-->键盘初始化中...</p>
<code ondblclick="this.innerHTML = '';this.style.display = 'none';" id="debug_box" class="debug_box"></code>
<main id="app" style="display: none;"
      @touchcancel="on_touch_cancel" @touchstart="on_touch_start"
      @touchmove="on_touch_move" @touchend="on_touch_end"
      ondblclick="return false;" @contextmenu="on_menu"
>
</main>
<script>
    // 加载html使用的是file://协议，无法使用<script type="module"，否则将会触发以下错误
    // "Failed to load module script: The server responded with a non-JavaScript MIME type of "".
    // Strict MIME type checking is enforced for module scripts per HTML spec.",
    // source: file:///android_asset/web/index.js?1569008605055 (0)
    // 键盘来的浏览器userAgent添加了自定义标志 SoftKeyboard
    let js = [navigator.userAgent.indexOf('SoftKeyboard') ? 'vue' : 'vue.dev', 'java'];
    js = js.concat(vue_components);
    vue_components.forEach(function (v, i) {
        vue_components[i] = '<' + v + '>' + '</' + v + '>';
    });
    document.getElementById('app').innerHTML = vue_components.join('');
    js = js.concat('index');
    for (let i = 97; i <= 122; i++) js.unshift('wu_bi_' + String.fromCharCode(i));
    let css = document.createElement('link');
    css.rel = 'stylesheet';
    css.href = "index.css?s" + +new Date;
    document.getElementsByTagName('head')[0].appendChild(css);
    js.forEach(function (name) {
        let js = document.createElement('script');
        js.src = name + '.js?' + +new Date;
        js.setAttribute('async',false);
        document.getElementsByTagName('head')[0].appendChild(js);
    });
</script>
</body>
</html>